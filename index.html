<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BurnBuddy TV (Final)</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { 
            background: #1a1a1a; 
            color: white; 
            text-align: center; 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden; 
        }
        
        /* é™¤éŒ¯è¦–çª—ï¼šè®“ä½ çŸ¥é“ç™¼ç”Ÿä»€éº¼äº‹ */
        #debug-console {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 100px;
            background: rgba(0,0,0,0.8); color: #0f0; font-family: monospace;
            font-size: 14px; text-align: left; padding: 10px; overflow-y: scroll;
            z-index: 99999; border-top: 1px solid #0f0;
        }

        #tv-frame {
            position: relative; width: 90%; height: 65vh;       
            background: #000; border: 5px solid #333; border-radius: 10px;
            overflow: hidden; margin: 0 auto;
        }

        #player { width: 100%; height: 100%; }

        /* å…¨è¢å¹•é®ç½©ï¼Œéš¨ä¾¿æŒ‰éƒ½è§£é– */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.9); 
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9000;
        }

        #start-btn {
            padding: 30px 50px; font-size: 2.5rem; font-weight: bold;
            background: #ff4081; color: white; border: 4px solid white;
            border-radius: 60px; animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        #status-bar { margin-top: 15px; font-size: 1.5rem; color: #ccc; }
    </style>
</head>
<body>

    <h1 style="margin: 10px;">ğŸ”¥ BurnBuddy ç‡ƒè„‚ç¥å™¨</h1>
    
    <div id="tv-frame">
        <div id="player"></div>
    </div>

    <div id="start-overlay" onclick="tryUnlock()">
        <button id="start-btn">è«‹æŒ‰é™æ§å™¨ã€Œä»»æ„éµã€</button>
        <p style="margin-top: 20px; color: #ccc;">(éŸ³é‡éµã€OKéµã€ä¸Šä¸‹å·¦å³çš†å¯)</p>
    </div>

    <div id="status-bar">ç³»çµ±è¼‰å…¥ä¸­...</div>
    <div id="debug-console">ç³»çµ±æ—¥èªŒ:<br></div>

    <script>
        // --- 1. æ—¥èªŒç³»çµ± ---
        var debugBox = document.getElementById('debug-console');
        function log(msg) {
            var time = new Date().toLocaleTimeString();
            debugBox.innerHTML = "[" + time + "] " + msg + "<br>" + debugBox.innerHTML;
        }

        window.onerror = function(msg) { log("âŒ éŒ¯èª¤: " + msg); };

        log("ğŸš€ ç³»çµ±å•Ÿå‹• (ç›¸å®¹æ¨¡å¼ v2.0)...");

        // --- 2. Firebase è¨­å®š (å·²å¹«ä½ å¡«å¥½è³‡æ–™åº«ç¶²å€) ---
        var firebaseConfig = {
            apiKey: "AIzaSyDjWvhVo6EM0cW_TDYVehzXcuovuU0lqOs",
            authDomain: "burnbuddy-d68c2.firebaseapp.com",
            // â˜…â˜…â˜… é€™è£¡å°±æ˜¯æœ€é—œéµçš„ä¸€è¡Œï¼Œæˆ‘å¹«ä½ è£œä¸Šäº† â˜…â˜…â˜…
            databaseURL: "https://burnbuddy-d68c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "burnbuddy-d68c2",
            storageBucket: "burnbuddy-d68c2.firebasestorage.app",
            messagingSenderId: "519617766080",
            appId: "1:519617766080:web:ef9c04ea8e3d4d8c218325"
        };

        // --- 3. åˆå§‹åŒ– Firebase ---
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            log("âœ… Firebase é€£ç·šæˆåŠŸï¼");
        } catch (e) {
            log("âŒ é€£ç·šå¤±æ•—: " + e.message);
        }

        var database = firebase.database();
        var player;
        var isUnlocked = false;
        var overlay = document.getElementById('start-overlay');
        var statusDisplay = document.getElementById('status-bar');

        // --- 4. è§£é–ç•«é¢ (è®“ç€è¦½å™¨å…è¨±æ’­æ”¾è²éŸ³) ---
        function tryUnlock() {
            if (isUnlocked) return;
            isUnlocked = true;
            overlay.style.display = 'none';
            log("ğŸ”“ ç•«é¢è§£é–ï¼æº–å‚™æ¥æ”¶æ‰‹æ©ŸæŒ‡ä»¤...");
            statusDisplay.innerText = "ç­‰å¾…æ‰‹æ©ŸæŒ‡ä»¤...";
            
            // è©¦æ’­ä¸€ä¸‹å†æš«åœ
            if (player && typeof player.playVideo === 'function') {
                player.playVideo();
                setTimeout(function() { player.pauseVideo(); }, 500);
            }
        }

        // è¬èƒ½ç›£è½ï¼šä¸ç®¡æŒ‰ä»€éº¼éƒ½æœƒè§¸ç™¼è§£é–
        document.addEventListener('keydown', function(e) { log("æŒ‰éµä»£ç¢¼: " + e.keyCode); tryUnlock(); });
        document.addEventListener('click', tryUnlock);
        document.addEventListener('touchstart', tryUnlock);

        // --- 5. YouTube API ---
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        window.onYouTubeIframeAPIReady = function() {
            log("YouTube API è¼‰å…¥å®Œæˆ");
            player = new YT.Player('player', {
                videoId: 'KJrm8eVs1pE', // é è¨­å½±ç‰‡
                playerVars: { 'playsinline': 1, 'controls': 0, 'rel': 0 },
                events: {
                    'onReady': onPlayerReady,
                    'onError': function(e) { log("YT Error: " + e.data); }
                }
            });
        };

        function onPlayerReady(event) {
            log("ğŸ“º æ’­æ”¾å™¨æº–å‚™å°±ç·’");
            
            // ç›£è½é›²ç«¯æŒ‡ä»¤
            database.ref('command').on('value', function(snapshot) {
                var cmd = snapshot.val();
                log("æ”¶åˆ°æŒ‡ä»¤: " + cmd);
                
                if (isUnlocked) {
                    if (cmd === 'play') {
                        player.playVideo();
                        statusDisplay.innerText = "â–¶ï¸ ç‡ƒè„‚é–‹å§‹ï¼";
                    } else if (cmd === 'pause') {
                        player.pauseVideo();
                        statusDisplay.innerText = "â¸ï¸ ä¼‘æ¯ä¸€ä¸‹";
                    } else if (cmd === 'kuikui') {
                        fireConfetti();
                        statusDisplay.innerText = "ğŸŒŸ å¥å¥å¥½æ£’ï¼ ğŸŒŸ";
                    }
                } else {
                    log("æŒ‡ä»¤ç•¥é (è«‹å…ˆæŒ‰é™æ§å™¨è§£é–)");
                }
            });
        }

        function fireConfetti() {
             var count = 200;
             var defaults = { origin: { y: 0.7 } };
             function fire(particleRatio, opts) {
                 confetti(Object.assign({}, defaults, opts, {
                     particleCount: Math.floor(count * particleRatio)
                 }));
             }
             fire(0.25, { spread: 26, startVelocity: 55 });
             fire(0.2, { spread: 60 });
             fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
             fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
             fire(0.1, { spread: 120, startVelocity: 45 });
        }
    </script>
</body>
</html>
