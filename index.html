<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BurnBuddy TV (Debug Mode)</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            background: #1a1a1a; 
            color: white; 
            text-align: center; 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden; 
        }
        
        /* --- é™¤éŒ¯è¦–çª— (é›»è¦–å°ˆç”¨) --- */
        #debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: rgba(0,0,0,0.9);
            color: #0f0; /* é§­å®¢ç¶  */
            font-family: monospace;
            font-size: 14px;
            text-align: left;
            padding: 10px;
            overflow-y: scroll;
            z-index: 99999;
            border-top: 2px solid #0f0;
            display: block; /* é è¨­é¡¯ç¤ºï¼Œä¿®å¥½å¾Œå†é—œæ‰ */
        }

        #tv-frame {
            position: relative;
            width: 90%;
            height: 60vh;       
            background: #000;
            border: 5px solid #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 auto;
        }

        #player { width: 100%; height: 100%; }

        #start-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.85); 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9000;
        }

        #start-btn {
            padding: 20px 40px;
            font-size: 2rem;
            font-weight: bold;
            background: #ff4081;
            color: white;
            border: 4px solid white;
            border-radius: 50px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        #status-bar {
            margin-top: 20px;
            font-size: 1.5rem;
            color: #ccc;
        }
    </style>
</head>
<body>

    <h1 style="margin: 10px;">ğŸ”¥ BurnBuddy é™¤éŒ¯æ¨¡å¼</h1>
    
    <div id="tv-frame">
        <div id="player"></div>
    </div>

    <div id="start-overlay">
        <button id="start-btn">è«‹æŒ‰é™æ§å™¨ã€Œä»»æ„éµã€</button>
        <p style="margin-top: 20px; color: #ccc;">(éŸ³é‡éµã€æ•¸å­—éµã€ä¸Šä¸‹å·¦å³çš†å¯)</p>
    </div>

    <div id="status-bar">ç³»çµ±è¼‰å…¥ä¸­...</div>

    <div id="debug-console">ç³»çµ±æ—¥èªŒ:<br></div>

    <script type="module">
        // --- 1. å»ºç«‹éŒ¯èª¤æ•æ‰æ©Ÿåˆ¶ (æœ€é‡è¦ï¼) ---
        const debugBox = document.getElementById('debug-console');
        function log(msg) {
            const time = new Date().toLocaleTimeString();
            debugBox.innerHTML = `[${time}] ${msg}<br>` + debugBox.innerHTML;
        }
        
        // æ•æ‰æ‰€æœ‰å…¨åŸŸéŒ¯èª¤
        window.onerror = function(message, source, lineno, colno, error) {
            log(`âŒ éŒ¯èª¤: ${message}`);
            // å¦‚æœçœ‹åˆ°é€™è£¡æœ‰ç´…å­—ï¼Œæ‹ç…§çµ¦æˆ‘çœ‹ï¼
        };

        log("ğŸš€ ç³»çµ±é–‹å§‹å•Ÿå‹•...");

        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        // --- 2. Firebase è¨­å®š (è«‹ç¢ºä¿é€™è£¡æ­£ç¢º) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDjWvhVo6EM0cW_TDYVehzXcuovuU0lqOs",
            authDomain: "burnbuddy-d68c2.firebaseapp.com",
            // â˜…â˜…â˜… é€™è£¡æ˜¯ä½ ä¹‹å‰å ±éŒ¯çš„åœ°æ–¹ï¼Œæˆ‘å¹«ä½ å¡«å¥½äº† â˜…â˜…â˜…
            databaseURL: "https://burnbuddy-d68c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "burnbuddy-d68c2",
            storageBucket: "burnbuddy-d68c2.firebasestorage.app",
            messagingSenderId: "519617766080",
            appId: "1:519617766080:web:ef9c04ea8e3d4d8c218325"
        };

        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getDatabase(app);
            log("âœ… Firebase é€£ç·šæˆåŠŸï¼");
        } catch (e) {
            log("âŒ Firebase é€£ç·šå¤±æ•—: " + e.message);
        }

        const overlay = document.getElementById('start-overlay');
        const statusDisplay = document.getElementById('status-bar');
        let player;
        let isUnlocked = false;

        // --- 3. è¬ç”¨æŒ‰éµç›£è½ (éš¨ä¾¿æŒ‰éƒ½æœƒè§¸ç™¼) ---
        window.addEventListener('keydown', (e) => {
            log(`æ”¶åˆ°æŒ‰éµè¨Šè™Ÿ: Code=${e.keyCode}, Key=${e.key}`);
            unlockAudio();
        });
        
        // ç‚ºäº†ä¿éšªï¼Œé€£è§¸æ§å’Œé»æ“Šä¹ŸåŠ ä¸Šå»
        window.addEventListener('click', () => { log("æ”¶åˆ°é»æ“Šè¨Šè™Ÿ"); unlockAudio(); });
        window.addEventListener('touchstart', () => { log("æ”¶åˆ°è§¸æ§è¨Šè™Ÿ"); unlockAudio(); });

        function unlockAudio() {
            if (isUnlocked) return;
            isUnlocked = true;
            overlay.style.display = 'none';
            log("ğŸ”“ ç³»çµ±è§£é–ï¼æº–å‚™æ’­æ”¾...");
            statusDisplay.innerText = "ç­‰å¾…æ‰‹æ©ŸæŒ‡ä»¤...";
            
            if(player && player.playVideo) {
                player.playVideo();
                setTimeout(() => player.pauseVideo(), 300);
            }
        }

        // --- 4. YouTube API ---
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        window.onYouTubeIframeAPIReady = function() {
            log("YouTube API è¼‰å…¥å®Œæˆ");
            player = new YT.Player('player', {
                videoId: 'KJrm8eVs1pE',
                playerVars: { 'playsinline': 1, 'controls': 0, 'rel': 0 },
                events: {
                    'onReady': onPlayerReady,
                    'onError': (e) => log("YT Error: " + e.data)
                }
            });
        };

        function onPlayerReady(event) {
            log("ğŸ“º æ’­æ”¾å™¨æº–å‚™å°±ç·’");
            
            // åªæœ‰åœ¨è³‡æ–™åº«é€£ç·šæˆåŠŸæ‰ç›£è½
            if(db) {
                const statusRef = ref(db, 'command');
                onValue(statusRef, (snapshot) => {
                    const cmd = snapshot.val();
                    log("æ”¶åˆ°é›²ç«¯æŒ‡ä»¤: " + cmd);
                    
                    if (isUnlocked) {
                        if (cmd === 'play') player.playVideo();
                        else if (cmd === 'pause') player.pauseVideo();
                        else if (cmd === 'kuikui') {
                            fireConfetti();
                            log("ç‰¹æ•ˆç™¼å°„ï¼");
                        }
                    } else {
                        log("æ”¶åˆ°æŒ‡ä»¤ä½†å°šæœªè§£é–ç•«é¢");
                    }
                });
            }
        }
        
        function fireConfetti() {
             var count = 200;
             var defaults = { origin: { y: 0.7 } };
             function fire(particleRatio, opts) {
                 confetti(Object.assign({}, defaults, opts, {
                     particleCount: Math.floor(count * particleRatio)
                 }));
             }
             fire(0.25, { spread: 26, startVelocity: 55 });
             fire(0.2, { spread: 60 });
             fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
             fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
             fire(0.1, { spread: 120, startVelocity: 45 });
        }
    </script>
</body>
</html>
