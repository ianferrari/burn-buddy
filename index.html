<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BurnBuddy TV</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            background: #1a1a1a; 
            color: white; 
            text-align: center; 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden; 
        }
        
        h1 { margin-bottom: 20px; text-shadow: 2px 2px 4px #000; }
        
        /* é›»è¦–æ¡†æ¡† */
        #tv-frame {
            position: relative;
            width: 85%;
            max-width: 1000px;
            height: 65vh;       
            min-height: 400px;  
            background: #000;
            border: 10px solid #333;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            overflow: hidden;
            margin: 0 auto;
        }

        #player { width: 100%; height: 100%; }

        /* --- å•Ÿå‹•é®ç½© (å…¨è¢å¹•æ„Ÿæ‡‰ç‰ˆ) --- */
        #start-overlay {
            position: fixed; /* æ”¹æˆ Fixedï¼Œå¼·åˆ¶è“‹ä½å…¨è¢å¹• */
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.85); 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer; /* è®“æ»‘é¼ æ¸¸æ¨™è®Šæ‰‹æ‰‹ */
            z-index: 9999; /* æœ€é ‚å±¤ */
        }

        #start-btn {
            padding: 30px 60px;
            font-size: 2.5rem;
            font-weight: bold;
            background: #ff4081;
            color: white;
            border: 4px solid white;
            border-radius: 60px;
            pointer-events: none; /* è®“æŒ‰éˆ•æœ¬èº«ã€Œä¸æ“‹è·¯ã€ï¼Œé»æ“Šæœƒç©¿é€åˆ°èƒŒæ™¯ */
            box-shadow: 0 0 40px rgba(255, 64, 129, 0.6);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        #status-bar {
            margin-top: 30px;
            padding: 15px 40px;
            background: #333;
            border-radius: 50px;
            font-size: 1.8rem;
            color: #ccc;
            transition: all 0.3s;
        }
        
        .reward-mode {
            color: #FFD700 !important;
            transform: scale(1.1);
            font-weight: bold;
            text-shadow: 0 0 20px #FFD700;
        }
    </style>
</head>
<body>

    <h1>ğŸ”¥ BurnBuddy å®¢å»³ç‡ƒè„‚ä¸­</h1>
    
    <div id="tv-frame">
        <div id="player"></div>
    </div>

    <div id="start-overlay">
        <button id="start-btn">ğŸ‘† æŒ‰é™æ§å™¨ OK éµå•Ÿç”¨</button>
        <p style="margin-top: 20px; color: #ccc; font-size: 1.5rem;">(é»æ“Šç•«é¢ä»»æ„è™•çš†å¯)</p>
    </div>

    <div id="status-bar">ç­‰å¾…å•Ÿå‹•...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDjWvhVo6EM0cW_TDYVehzXcuovuU0lqOs",
            authDomain: "burnbuddy-d68c2.firebaseapp.com",
            databaseURL: "https://burnbuddy-d68c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "burnbuddy-d68c2",
            storageBucket: "burnbuddy-d68c2.firebasestorage.app",
            messagingSenderId: "519617766080",
            appId: "1:519617766080:web:ef9c04ea8e3d4d8c218325"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const statusDisplay = document.getElementById('status-bar');
        const overlay = document.getElementById('start-overlay');

        let player;
        const videoId = 'KJrm8eVs1pE'; 
        let isUnlocked = false; // æ¨™è¨˜æ˜¯å¦å·²ç¶“è§£é–

        // --- è¬èƒ½è§£é–å‡½å¼ ---
        window.unlockAudio = function() {
            if(isUnlocked) return; // å¦‚æœå·²ç¶“è§£é–éï¼Œå°±ä¸é‡è¤‡åŸ·è¡Œ
            
            console.log("è§¸ç™¼è§£é–ï¼");
            overlay.style.display = 'none'; // éš±è—é®ç½©
            statusDisplay.innerText = "ç³»çµ±å°±ç·’ï¼è«‹ç”¨æ‰‹æ©Ÿæ§åˆ¶";
            isUnlocked = true;

            // è©¦åœ–æ’­æ”¾ä¸€ä¸‹ä¸‹
            if(player && player.playVideo) {
                 player.playVideo();
                 setTimeout(() => { player.pauseVideo(); }, 300); 
            }
        };

        // --- ä¸‰é‡ç›£è½ (Click, Touch, Keydown) ---
        // 1. æ»‘é¼ /æ¸¸æ¨™é»æ“Š
        overlay.addEventListener('click', window.unlockAudio);
        
        // 2. è§¸æ§ (é‡å°éƒ¨åˆ†æ™ºæ…§é›»è¦–é™æ§å™¨)
        overlay.addEventListener('touchstart', window.unlockAudio);

        // 3. éµç›¤/é™æ§å™¨æŒ‰éµ (é€™æ˜¯é‡å° OK éµçš„è§£æ³•)
        window.addEventListener('keydown', function(e) {
            console.log("æŒ‰éµä»£ç¢¼:", e.keyCode);
            // 13 æ˜¯ Enter éµï¼Œä¹Ÿæ˜¯å¤§å¤šæ•¸é™æ§å™¨çš„ OK éµ
            if (e.key === 'Enter' || e.keyCode === 13 || e.keyCode === 32) { 
                window.unlockAudio();
            }
        });

        // è¼‰å…¥ YouTube API
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('player', {
                videoId: videoId,
                playerVars: { 'playsinline': 1, 'controls': 0, 'rel': 0, 'fs': 0 },
                events: {
                    'onReady': onPlayerReady,
                    'onError': onPlayerError
                }
            });
        };

        function onPlayerReady(event) {
            console.log("Player Ready");
            const statusRef = ref(db, 'command');
            onValue(statusRef, (snapshot) => {
                const cmd = snapshot.val();
                
                // åªæœ‰è§£é–å¾Œæ‰å‹•ä½œ
                if (isUnlocked) {
                    if (cmd === 'play') {
                        player.playVideo();
                        updateStatus("â–¶ï¸ ç‡ƒè„‚é–‹å§‹ï¼", false);
                    } else if (cmd === 'pause') {
                        player.pauseVideo();
                        updateStatus("â¸ï¸ ä¼‘æ¯ä¸€ä¸‹", false);
                    } else if (cmd === 'kuikui') {
                        updateStatus("ğŸŒŸ å¥å¥å¥½æ£’ï¼ ğŸŒŸ", true);
                        fireConfetti();
                        setTimeout(() => { 
                             let state = player.getPlayerState();
                             updateStatus(state === 1 ? "â–¶ï¸ ç‡ƒè„‚é–‹å§‹ï¼" : "â¸ï¸ ä¼‘æ¯ä¸€ä¸‹", false);
                        }, 3000);
                    }
                }
            });
        }

        function onPlayerError(event) {
            statusDisplay.innerText = "å½±ç‰‡è¼‰å…¥éŒ¯èª¤ (Code: " + event.data + ")";
        }

        function updateStatus(text, isReward) {
            statusDisplay.innerText = text;
            if (isReward) statusDisplay.classList.add('reward-mode');
            else statusDisplay.classList.remove('reward-mode');
        }

        function fireConfetti() {
            var count = 200;
            var defaults = { origin: { y: 0.7 } };
            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }
            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });
        }
    </script>
</body>
</html>
