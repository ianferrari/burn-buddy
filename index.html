<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BurnBuddy TV</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { 
            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
            color: white; 
            text-align: center; 
            font-family: sans-serif; /* æ”¹å›é€šç”¨å­—é«”ï¼Œé¿å…é›»è¦–ä¸æ”¯æ´ */
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            height: 100vh; margin: 0; overflow: hidden; 
        }
        
        h1 { 
            margin-bottom: 20px; font-weight: normal; 
            text-shadow: 0 2px 5px rgba(0,0,0,0.5); font-size: 2.5rem;
        }
        
        #tv-frame {
            position: relative; width: 90%; height: 70vh;       
            background: #000; border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden; margin: 0 auto; border: 2px solid #333;
        }

        #player { width: 100%; height: 100%; }

        /* --- å…¼å®¹æ€§å„ªåŒ–çš„é®ç½© --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); 
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
        }

        #start-btn {
            padding: 20px 50px; font-size: 2rem; font-weight: bold;
            background: #ff4081; color: white; border: 4px solid white;
            border-radius: 50px; cursor: pointer;
        }

        #status-bar { 
            margin-top: 20px; font-size: 1.8rem; color: #ccc; min-height: 1.5em;
        }
        
        .reward-text {
            color: #FFD700 !important; font-weight: bold;
            font-size: 2.2rem !important; /* å¼·åˆ¶æ”¾å¤§ */
            text-shadow: 2px 2px 0px #000;
        }

        /* --- ğŸŒŸ ä¿®æ­£ç‰ˆå¤§æ˜Ÿæ˜Ÿ --- */
        /* æ”¾æ£„è¤‡é›œå‹•ç•«ï¼Œæ”¹ç”¨æœ€ç°¡å–®çš„ç½®ä¸­é¡¯ç¤ºï¼Œç¢ºä¿èˆŠé›»è¦–ç›¸å®¹ */
        #big-star-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; /* é è¨­éš±è— */
            justify-content: center; align-items: center;
            z-index: 8888;
            background: rgba(0,0,0,0.3); /* ç¨å¾®æš—ä¸€é»è®“æ˜Ÿæ˜Ÿæ›´æ˜é¡¯ */
        }
        #big-star {
            font-size: 12rem; /* å­—é«”è¶…å¤§ */
            filter: drop-shadow(0 0 20px gold);
        }
    </style>
</head>
<body>

    <h1>ğŸ”¥ BurnBuddy å®¢å»³ç‡ƒè„‚</h1>
    
    <div id="tv-frame">
        <div id="player"></div>
    </div>
    
    <div id="big-star-container">
        <div id="big-star">ğŸŒŸ</div>
    </div>

    <div id="start-overlay" onclick="tryUnlock()">
        <button id="start-btn">æŒ‰é™æ§å™¨ã€Œä»»æ„éµã€å•Ÿç”¨</button>
        <p style="margin-top: 20px; color: #bbb; font-size: 1.2rem;">(é»æ“Šè§£é–éŸ³æ•ˆ)</p>
    </div>

    <div id="status-bar">ç³»çµ±è¼‰å…¥ä¸­...</div>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyDjWvhVo6EM0cW_TDYVehzXcuovuU0lqOs",
            authDomain: "burnbuddy-d68c2.firebaseapp.com",
            databaseURL: "https://burnbuddy-d68c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "burnbuddy-d68c2",
            storageBucket: "burnbuddy-d68c2.firebasestorage.app",
            messagingSenderId: "519617766080",
            appId: "1:519617766080:web:ef9c04ea8e3d4d8c218325"
        };

        try { if (!firebase.apps.length) firebase.initializeApp(firebaseConfig); } catch (e) {}

        var database = firebase.database();
        var player;
        var isUnlocked = false;
        var overlay = document.getElementById('start-overlay');
        var statusDisplay = document.getElementById('status-bar');
        var starContainer = document.getElementById('big-star-container');
        var audioCtx;

        // é è¨­å½±ç‰‡ (Chuckmeo 10åˆ†é˜)
        var currentVideoId = 'KJrm8eVs1pE'; 

        // éš¨æ©Ÿç¨±è®šèªéŒ„
        var praisePhrases = [
            "å¥å¥å¥½æ£’ï¼", 
            "å¥å¥ä½ å¥½å¼·ï¼", 
            "å¥å¥æœ€å²å®³ï¼", 
            "å¥å¥æ˜¯è¶…äººï¼", 
            "å¥å¥å¸¥å‘†äº†ï¼", 
            "å¥å¥NO.1ï¼"
        ];

        function tryUnlock() {
            if (isUnlocked) return;
            isUnlocked = true;
            
            try {
                var AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
                playTone(600, 0.1); 
            } catch(e) {}

            overlay.style.display = 'none'; // ç›´æ¥éš±è—ï¼Œä¸ç©æ·¡å‡º
            statusDisplay.innerText = "æ‰‹æ©Ÿé€£ç·šä¸­...";
            
            if (player && typeof player.playVideo === 'function') {
                player.playVideo();
                setTimeout(function() { player.pauseVideo(); }, 500);
            }
        }

        function playTone(freq, duration) {
            if (!audioCtx) return;
            var osc = audioCtx.createOscillator();
            var gain = audioCtx.createGain();
            osc.frequency.value = freq;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.stop(audioCtx.currentTime + duration);
        }

        function playRewardSound(text) {
            // 1. éš¨æ©ŸéŸ³æ•ˆ (é »ç‡ç¨å¾®äº‚æ•¸ä¸€é»)
            if(audioCtx) {
                var base = 800 + Math.random() * 200; 
                setTimeout(function() { playTone(base, 0.1); }, 0);
                setTimeout(function() { playTone(base + 400, 0.1); }, 100);
                setTimeout(function() { playTone(base + 800, 0.3); }, 200);
            }
            // 2. éš¨æ©ŸèªéŸ³
            if ('speechSynthesis' in window) {
                var utterance = new SpeechSynthesisUtterance(text); // å”¸å‡ºéš¨æ©Ÿé¸åˆ°çš„å¥å­
                utterance.lang = 'zh-TW';
                utterance.rate = 1.2; 
                window.speechSynthesis.speak(utterance);
            }
        }

        document.addEventListener('keydown', function(e) { tryUnlock(); });
        document.addEventListener('click', tryUnlock);
        document.addEventListener('touchstart', tryUnlock);

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('player', {
                videoId: currentVideoId,
                playerVars: { 'playsinline': 1, 'controls': 0, 'rel': 0 },
                events: { 'onReady': onPlayerReady }
            });
        };

        function onPlayerReady(event) {
            database.ref('command').on('value', function(snapshot) {
                var cmd = snapshot.val();
                if (isUnlocked) {
                    if (cmd === 'play') {
                        player.playVideo();
                        updateStatus("â–¶ï¸ ç‡ƒè„‚é–‹å§‹ï¼", false);
                    } else if (cmd === 'pause') {
                        player.pauseVideo();
                        updateStatus("â¸ï¸ ä¼‘æ¯ä¸€ä¸‹", false);
                    } else if (cmd === 'kuikui') {
                        // éš¨æ©ŸæŠ½ä¸€å¥è©±
                        var randomPhrase = praisePhrases[Math.floor(Math.random() * praisePhrases.length)];
                        
                        fireConfetti();
                        playRewardSound(randomPhrase); // æŠŠå¥å­å‚³é€²å»å”¸
                        
                        // é¡¯ç¤ºå¤§æ˜Ÿæ˜Ÿ (æš´åŠ›é¡¯ç¤ºæ³•)
                        starContainer.style.display = 'flex';
                        updateStatus("ğŸŒŸ " + randomPhrase + " ğŸŒŸ", true);
                        
                        // 3ç§’å¾Œéš±è—
                        setTimeout(function(){ 
                            starContainer.style.display = 'none';
                            updateStatus("â–¶ï¸ ç¹¼çºŒç‡ƒè„‚ï¼", false); 
                        }, 3000);
                    }
                }
            });

            database.ref('videoId').on('value', function(snapshot) {
                var newId = snapshot.val();
                if (newId && newId !== currentVideoId) {
                    currentVideoId = newId;
                    if(player && player.loadVideoById) {
                        player.loadVideoById(newId);
                        if(isUnlocked) updateStatus("ğŸ”„ åˆ‡æ›å½±ç‰‡ä¸­...", false);
                    }
                }
            });
        }

        function updateStatus(text, isReward) {
            statusDisplay.innerText = text;
            if(isReward) statusDisplay.classList.add('reward-text');
            else statusDisplay.classList.remove('reward-text');
        }

        function fireConfetti() {
             var count = 200;
             var defaults = { origin: { y: 0.7 } };
             function fire(particleRatio, opts) {
                 confetti(Object.assign({}, defaults, opts, {
                     particleCount: Math.floor(count * particleRatio)
                 }));
             }
             fire(0.25, { spread: 26, startVelocity: 55 });
             fire(0.2, { spread: 60 });
             fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
             fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
             fire(0.1, { spread: 120, startVelocity: 45 });
        }
    </script>
</body>
</html>
