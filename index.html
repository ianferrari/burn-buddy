<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BurnBuddy TV</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { background: #1a1a1a; color: white; text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        
        h1 { margin-bottom: 20px; text-shadow: 2px 2px 4px #000; }
        
        /* é›»è¦–æ¡†æ¡†é€ å‹ */
        #tv-frame {
            position: relative;
            width: 80%;
            max-width: 900px;
            aspect-ratio: 16/9;
            background: #000;
            border: 10px solid #333;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            overflow: hidden;
        }

        /* è®“ YouTube å¡«æ»¿æ¡†æ¡† */
        #player { width: 100%; height: 100%; }

        /* ç‹€æ…‹æ–‡å­— */
        #status-bar {
            margin-top: 30px;
            padding: 10px 20px;
            background: #333;
            border-radius: 50px;
            font-size: 1.5rem;
            color: #ccc;
            transition: all 0.3s;
        }
        
        /* å¥å¥æ¨¡å¼çš„ç‰¹æ•ˆå­— */
        .reward-mode {
            color: #FFD700 !important; /* é‡‘è‰² */
            transform: scale(1.2);
            font-weight: bold;
            text-shadow: 0 0 10px #FFD700;
        }
    </style>
</head>
<body>

    <h1>ğŸ”¥ BurnBuddy å®¢å»³ç‡ƒè„‚ä¸­</h1>
    
    <div id="tv-frame">
        <div id="player"></div>
    </div>

    <div id="status-bar">ç­‰å¾…æŒ‡ä»¤...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        // ä½ çš„ Firebase è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyDjWvhVo6EM0cW_TDYVehzXcuovuU0lqOs",
            authDomain: "burnbuddy-d68c2.firebaseapp.com",
            databaseURL: "https://burnbuddy-d68c2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "burnbuddy-d68c2",
            storageBucket: "burnbuddy-d68c2.firebasestorage.app",
            messagingSenderId: "519617766080",
            appId: "1:519617766080:web:ef9c04ea8e3d4d8c218325"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const statusDisplay = document.getElementById('status-bar');

        // --- YouTube API è¨­å®š ---
        let player;
        // é€™è£¡å¯ä»¥æ›æˆä»»ä½•ä½ è€å©†æƒ³è·³çš„å½±ç‰‡ ID (ä¾‹å¦‚: å¸•æ¢…æ‹‰çš„å½±ç‰‡)
        // ç›®å‰æ˜¯ç”¨ Coffee æ—èŠŠå¦¤çš„å½±ç‰‡ç•¶ç¯„ä¾‹
        const videoId = 'KJrm8eVs1pE'; 

        // è¼‰å…¥ YouTube IFrame API
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // ç•¶ YouTube API æº–å‚™å¥½æ™‚ï¼Œå»ºç«‹æ’­æ”¾å™¨
        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('player', {
                videoId: videoId,
                playerVars: {
                    'playsinline': 1,
                    'controls': 0, // éš±è— YouTubeåŸæœ¬çš„æ§åˆ¶åˆ—(å¼·è¿«ç”¨æ‰‹æ©Ÿæ§)
                    'rel': 0       // æ’­å®Œä¸é¡¯ç¤ºæ¨è–¦å½±ç‰‡
                },
                events: {
                    'onReady': onPlayerReady
                }
            });
        };

        // ç•¶æ’­æ”¾å™¨æº–å‚™å¥½å¾Œï¼Œé–‹å§‹ç›£è½ Firebase
        function onPlayerReady(event) {
            console.log("YouTube Player æº–å‚™å°±ç·’ï¼");
            
            // ç›£è½ Firebase æŒ‡ä»¤
            const statusRef = ref(db, 'command');
            onValue(statusRef, (snapshot) => {
                const cmd = snapshot.val();
                console.log("æ”¶åˆ°æŒ‡ä»¤:", cmd);

                if (cmd === 'play') {
                    player.playVideo(); // çœŸçš„æ’­æ”¾å½±ç‰‡
                    updateStatus("â–¶ï¸ ç‡ƒè„‚é–‹å§‹ï¼", false);
                } 
                else if (cmd === 'pause') {
                    player.pauseVideo(); // çœŸçš„æš«åœå½±ç‰‡
                    updateStatus("â¸ï¸ ä¼‘æ¯ä¸€ä¸‹", false);
                } 
                else if (cmd === 'kuikui') {
                    // å¥å¥çå‹µï¼šä¸å½±éŸ¿å½±ç‰‡æ’­æ”¾ï¼Œåªæ”¾ç‰¹æ•ˆ
                    updateStatus("ğŸŒŸ å¥å¥å¥½æ£’ï¼è¶…ç´šæ˜Ÿæ˜Ÿï¼ ğŸŒŸ", true);
                    fireConfetti(); // ç™¼å°„å½©å¸¶
                    
                    // 3ç§’å¾Œæ¢å¾©æ–‡å­—
                    setTimeout(() => { 
                        // åˆ¤æ–·ç›®å‰å½±ç‰‡ç‹€æ…‹ä¾†æ±ºå®šæ–‡å­—
                        let state = player.getPlayerState();
                        if(state === 1) updateStatus("â–¶ï¸ ç‡ƒè„‚é–‹å§‹ï¼", false);
                        else updateStatus("â¸ï¸ ä¼‘æ¯ä¸€ä¸‹", false);
                    }, 3000);
                }
            });
        }

        function updateStatus(text, isReward) {
            statusDisplay.innerText = text;
            if (isReward) {
                statusDisplay.classList.add('reward-mode');
            } else {
                statusDisplay.classList.remove('reward-mode');
            }
        }

        // --- å½©å¸¶ç‰¹æ•ˆå‡½å¼ ---
        function fireConfetti() {
            var count = 200;
            var defaults = {
                origin: { y: 0.7 }
            };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });
        }
    </script>
</body>
</html>
